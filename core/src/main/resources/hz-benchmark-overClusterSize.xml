<!-- This test shows example comparison between three products -->
<benchmark xmlns="urn:radargun:benchmark:3.0">

   <!-- Specifies where should the master open socket  -->
   <master bindAddress="${master.address:127.0.0.1}" port="${master.port:2103}"/>

   <clusters>
      <scale from="2" to="12" inc="2">
         <cluster />
      </scale>
   </clusters>

   <!-- List of configurations of the services -->
   <configurations>
       <!-- Note that Coherence is not compiled by default -->
       <config name="Coherence 12.x">
           <setup plugin="coherence12">
               <coherence xmlns="urn:radargun:plugins:coherence12:3.0" file="dist.xml"/>
           </setup>
       </config>
       <config name="Hazelcast ${hzOlderVersion}">
           <setup plugin="hazelcast3">
               <hazelcast xmlns="urn:radargun:plugins:hazelcast3:3.0" file="dist-sync.xml"/>
           </setup>
       </config>
       <config name="Hazelcast ${hzHatMasterVersion}">
           <setup plugin="hazelcastMaster">
               <hazelcast xmlns="urn:radargun:plugins:hazelcastMaster:3.0" file="dist-sync.xml"/>
           </setup>
       </config>
   </configurations>

   <!-- Sequence of stages executed on the cluster -->
   <scenario>
      <!-- Start services on all nodes -->
      <service-start />
      <!-- Begin monitoring of CPU, memory usage and GC -->
      <jvm-monitor-start />

      <!-- Preload the cache with data -->
      <load-data num-entries="5000"/>
      <!-- 5 threads will execute total of 100,000 random requests against the default cache ('testCache')-->
      <!-- As the test is called 'warmup', performance statistics won't be reported -->
      <basic-operations-test test-name="warmup" num-requests="100000" num-threads-per-node="5">
         <key-selector>
            <concurrent-keys total-entries="5000" />
         </key-selector>
      </basic-operations-test>

      <!-- Remove all data from the default cache -->
      <clear-cache />
      <!-- Again, preload the cache with data -->
      <load-data num-entries="10000"/>


      <basic-operations-test test-name="stress-test" duration="1m" num-threads-per-node="64">
            <key-selector>
               <concurrent-keys total-entries="10000"/>
            </key-selector>
            <statistics>
               <default>
                  <operation-stats>
                     <default />
                     <histogram />
                  </operation-stats>
               </default>
            </statistics>
      </basic-operations-test>

      <!-- Stop JVM monitoring -->
      <jvm-monitor-stop />
   </scenario>
   <!-- Ignore leaked threads as Coherence leaks quite often -->
   <cleanup check-threads="false" />

   <!-- How the statistics are reported -->
   <reports>
      <!-- Produce CSV statistics report -->
       <reporter type="csv" />
      <!-- Produce HTML statistics report -->
       <reporter type="html" />

       <reporter type="html">
           <report>
               <html xmlns="urn:radargun:reporters:reporter-default:3.0"
                     target-dir="results/html-default"/>
           </report>
           <report>
               <html xmlns="urn:radargun:reporters:reporter-default:3.0"
                     target-dir="results/html-separate">
                   <test-report separate-cluster-charts="true" />
               </html>
           </report>
       </reporter>

   </reports>

</benchmark>
